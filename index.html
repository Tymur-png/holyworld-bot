<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>CosmoPunk Tap Game</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root{
  --bg:#0a001a;
  --n1:#ff00ff;
  --n2:#00ffff;
  --panel:rgba(255,255,255,0.06);
  --glow:0 0 35px;
}
*{margin:0;padding:0;box-sizing:border-box}
body{
  background:radial-gradient(circle at top,#1a0033,var(--bg));
  font-family:Arial,Helvetica,sans-serif;
  color:#fff;
  overflow:hidden;
}
#app{height:100vh;position:relative}

/* HUD */
#hud{
  position:absolute;top:10px;left:10px;right:10px;
  display:flex;justify-content:space-between;z-index:10
}
.badge{
  background:var(--panel);
  padding:6px 12px;
  border-radius:14px;
  backdrop-filter:blur(6px);
  font-weight:bold;
}
#energy{text-shadow:var(--glow) var(--n1)}
#rank{font-size:12px;opacity:.7}

/* Reactor */
#center{
  position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center
}
#reactor{
  width:320px;height:320px;
  border-radius:28px;
  background:rgba(255,255,255,.05);
  box-shadow:var(--glow) var(--n1);
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;
}
#reactor img{width:85%}

/* Floating */
.float{
  position:absolute;
  color:var(--n2);
  font-size:26px;
  font-weight:bold;
  pointer-events:none;
}

/* Bottom bar */
#bottom{
  position:absolute;bottom:0;left:0;right:0;
  padding:10px;
  background:linear-gradient(transparent,var(--bg));
}
#bar{display:flex;gap:8px;overflow-x:auto}
.btn{
  background:var(--panel);
  border:1px solid rgba(255,255,255,.15);
  padding:10px 14px;
  border-radius:16px;
  font-weight:bold;
  cursor:pointer;
  white-space:nowrap;
}

/* Popup */
#pop{
  position:fixed;inset:0;
  background:rgba(0,0,0,.8);
  display:none;
  align-items:center;justify-content:center;
  z-index:100;
}
#card{
  background:#0a001a;
  padding:18px;
  border-radius:18px;
  max-width:92%;
  max-height:92%;
  overflow:auto;
}
.item{
  border:1px solid rgba(255,255,255,.1);
  border-radius:14px;
  padding:12px;
  margin-bottom:10px;
}
h2{text-align:center;color:var(--n1);margin-bottom:10px}
.small{font-size:13px;opacity:.7}
</style>
</head>

<body>
<div id="app">

<div id="hud">
  <div>
    <div id="energy" class="badge">0 PUNK</div>
    <div id="rank">Street Rat</div>
    <div id="inc" class="small">0 /сек</div>
  </div>
</div>

<div id="center">
  <div id="reactor">
    <img src="assets/reactor/reactor.gif">
  </div>
</div>

<div id="bottom">
  <div id="bar">
    <div class="btn" onclick="openFleet()">ФЛОТ</div>
    <div class="btn" onclick="openCrew()">ЭКИПАЖ</div>
    <div class="btn" onclick="openImplants()">ИМПЛАНТЫ</div>
    <div class="btn" onclick="openRaid()">РЕЙД</div>
    <div class="btn" onclick="openMarket()">МАГАЗИН</div>
    <div class="btn" onclick="openProfile()">ПРОФИЛЬ</div>
    <div class="btn" onclick="openSettings()">⚙️</div>
  </div>
</div>

</div>

<div id="pop" onclick="if(event.target.id==='pop')closePop()">
  <div id="card"></div>
</div>

<script>
Telegram.WebApp.ready();

/* ===== DATA ===== */
let s = JSON.parse(localStorage.getItem("cp_save")) || {
  energy:0,
  punk:0,
  total:0,
  pass:0,
  rank:0,
  ships:{},
  implants:{},
  crew:{},
  maxShips:3,
  lang:null,
  last:Date.now()
};

const RANKS=["Street Rat","Neon Scavenger","Void Pirate","Cyber Overlord","Galaxy Baron"];

/* ===== SAVE / OFFLINE ===== */
function save(){localStorage.setItem("cp_save",JSON.stringify(s))}
let diff=(Date.now()-s.last)/1000;
s.energy+=s.pass*diff;
s.last=Date.now();

/* ===== UI ===== */
const energyEl=document.getElementById("energy");
const rankEl=document.getElementById("rank");
const incEl=document.getElementById("inc");
function ui(){
  energyEl.textContent=Math.floor(s.energy)+" PUNK";
  incEl.textContent=s.pass.toFixed(1)+" /сек";
  rankEl.textContent=RANKS[s.rank];
}

/* ===== TAP ===== */
document.getElementById("reactor").onclick=e=>{
  s.energy+=1;
  s.total+=1;
  if(s.total>1000)s.rank=1;
  if(s.total>10000)s.rank=2;
  if(s.total>50000)s.rank=3;
  if(s.total>200000)s.rank=4;

  const f=document.createElement("div");
  f.className="float";
  f.textContent="+1";
  f.style.left=e.clientX+"px";
  f.style.top=e.clientY+"px";
  document.body.appendChild(f);
  f.animate([{transform:"translateY(0)",opacity:1},{transform:"translateY(-100px)",opacity:0}],{duration:900});
  setTimeout(()=>f.remove(),900);

  ui();save();
};

/* ===== POPUP ===== */
function show(html){card.innerHTML=html;pop.style.display="flex"}
function closePop(){pop.style.display="none"}

/* ===== SECTIONS ===== */
function openFleet(){
  let h="<h2>ФЛОТ</h2>";
  for(let i=1;i<=10;i++){
    if(!s.ships[i]){
      h+=`<div class="item">Корабль #${i}<br>
      <button onclick="buyShip(${i})">Купить</button></div>`;
    }
  }
  show(h);
}
function buyShip(i){
  if(Object.keys(s.ships).length>=s.maxShips){
    alert("Лимит кораблей");
    return;
  }
  s.ships[i]=true;
  s.pass+=5;
  save();openFleet();
}

function openImplants(){
  let h="<h2>ИМПЛАНТЫ</h2>";
  ["neuro","glitch","eye","chip"].forEach(k=>{
    if(!s.implants[k]){
      h+=`<div class="item">${k}<br>
      <button onclick="buyImpl('${k}')">Купить</button></div>`;
    }
  });
  show(h);
}
function buyImpl(k){
  s.implants[k]=true;
  s.pass+=2;
  save();openImplants();
}

function openCrew(){show("<h2>ЭКИПАЖ</h2><p>Бонусы скоро</p>")}
function openRaid(){show("<h2>РЕЙД</h2><p>Скоро</p>")}
function openMarket(){show("<h2>МАГАЗИН</h2><p>Усиления</p>")}

function openProfile(){
  let h="<h2>ПРОФИЛЬ</h2>";
  h+="<b>Корабли:</b><br>"+Object.keys(s.ships).join(", ")+"<br><br>";
  h+="<b>Импланты:</b><br>"+Object.keys(s.implants).join(", ");
  show(h);
}

function openSettings(){
  show(`<h2>ЯЗЫК</h2>
  <button onclick="setLang('ru')">Русский</button>
  <button onclick="setLang('en')">English</button>
  <button onclick="setLang('pl')">Polski</button>`);
}
function setLang(l){s.lang=l;save();closePop()}

ui();
setInterval(()=>{s.energy+=s.pass/10;ui();save()},1000);
</script>
</body>
</html>