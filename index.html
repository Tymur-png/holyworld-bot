<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>CosmoPunk</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root{
--bg:#0a001a;
--n1:#ff00ff;
--n2:#00ffff;
}
*{box-sizing:border-box}
body{
margin:0;
background:radial-gradient(circle at top,#1a0033,var(--bg));
color:#fff;
font-family:Inter,Arial,monospace;
overflow:hidden;
}
#app{height:100vh;display:flex;flex-direction:column}

/* HEADER */
#top{
padding:10px;
text-align:center;
}
#energy{font-size:28px;color:var(--n1)}
#inc{font-size:14px;color:var(--n2)}
#rank{font-size:12px;opacity:.7}

/* REACTOR */
#reactor{
width:260px;
height:260px;
margin:10px auto;
background:url("/assets/reactor.png") center/contain no-repeat;
filter:drop-shadow(0 0 35px var(--n1));
cursor:pointer;
}

/* MENU */
#menu{
margin-top:auto;
display:grid;
grid-template-columns:repeat(5,1fr);
padding:6px;
background:rgba(0,0,0,.4);
}
.btn{
margin:4px;
padding:10px;
border-radius:14px;
border:2px solid var(--n2);
background:linear-gradient(45deg,rgba(255,0,255,.15),rgba(0,255,255,.15));
font-weight:700;
text-align:center;
cursor:pointer;
}

/* MODAL */
.modal{
position:fixed;
inset:0;
background:rgba(0,0,0,.85);
display:none;
z-index:1000;
overflow:auto;
}
.box{
max-width:520px;
margin:30px auto;
border:2px solid var(--n1);
border-radius:18px;
padding:16px;
background:rgba(10,0,30,.95);
}
.item{
display:flex;
gap:12px;
align-items:center;
border:1px solid var(--n2);
border-radius:12px;
padding:10px;
margin-bottom:10px;
}
.item img{width:48px;height:48px}
.close{margin-top:10px}

/* LANGUAGE */
#langModal{
position:fixed;
inset:0;
background:#000;
display:none;
z-index:2000;
align-items:center;
justify-content:center;
}
</style>
</head>

<body>
<div id="app">

<div id="top">
<div id="energy">0 PUNK</div>
<div id="inc">0 / сек</div>
<div id="rank">Street Rat</div>
</div>

<div id="reactor"></div>

<div id="menu">
<div class="btn" onclick="openFleet()">ФЛОТ</div>
<div class="btn" onclick="openImplants()">ИМПЛАНТЫ</div>
<div class="btn" onclick="openCrew()">ЭКИПАЖ</div>
<div class="btn" onclick="openProfile()">ПРОФИЛЬ</div>
<div class="btn" onclick="openSettings()">⚙</div>
</div>

</div>

<div id="modal" class="modal"><div class="box" id="box"></div></div>

<div id="langModal">
<div class="box">
<h2>Select language</h2>
<div class="btn" onclick="setLang('ru')">Русский</div>
<div class="btn" onclick="setLang('en')">English</div>
<div class="btn" onclick="setLang('pl')">Polski</div>
</div>
</div>

<script>
Telegram.WebApp.ready();
Telegram.WebApp.expand();

/* ===== SAVE ===== */
let s = JSON.parse(localStorage.cp_save || "{}");
Object.assign(s,{
energy:s.energy||0,
tap:1,
pph:s.pph||0,
ships:s.ships||{},
implants:s.implants||{},
equipped:s.equipped||{},
crew:s.crew||{},
shipLimit:s.shipLimit||3,
lang:s.lang||null
});

/* ===== DATA ===== */
const SHIPS={
reaper:{name:"Void Reaper",img:"/assets/ships/reaper.png",inc:50},
corsair:{name:"Neon Corsair",img:"/assets/ships/corsair.png",inc:30}
};
const IMPLANTS={
neuro:{name:"Neuro Implant",img:"/assets/implants/neuro.png",tap:2},
glitch:{name:"Glitch Chip",img:"/assets/implants/glitch.png",tap:1.5}
};
const CREW={
bot:{name:"Auto Bot",inc:10}
};

/* ===== LANGUAGE ===== */
if(!s.lang) langModal.style.display="flex";

/* ===== TAP ===== */
reactor.onclick=()=>{
s.energy+=s.tap;
save();ui();
};

/* ===== UI ===== */
function ui(){
energy.innerText=Math.floor(s.energy)+" PUNK";
inc.innerText=s.pph+" / сек";
}
ui();

/* ===== MODAL ===== */
function show(html){
box.innerHTML=html+`<div class="btn close" onclick="closeModal()">Закрыть</div>`;
modal.style.display="block";
}
function closeModal(){modal.style.display="none"}

/* ===== FLEET ===== */
function openFleet(){
let total = Object.values(s.ships).reduce((a,b)=>a+b,0);
let html=`<h2>Флот</h2><div>Лимит: ${total}/${s.shipLimit}</div>`;
for(let k in SHIPS){
html+=`
<div class="item">
<img src="${SHIPS[k].img}">
<div>${SHIPS[k].name}<br>+${SHIPS[k].inc}/сек</div>
<div class="btn" onclick="buyShip('${k}')">Купить</div>
</div>`;
}
show(html);
}
function buyShip(id){
let total=Object.values(s.ships).reduce((a,b)=>a+b,0);
if(total>=s.shipLimit) return alert("Лимит кораблей");
s.ships[id]=(s.ships[id]||0)+1;
s.pph+=SHIPS[id].inc;
save();openFleet();ui();
}

/* ===== IMPLANTS ===== */
function openImplants(){
let html="<h2>Импланты</h2>";
for(let k in IMPLANTS){
let owned=s.implants[k];
let eq=s.equipped[k];
html+=`
<div class="item">
<img src="${IMPLANTS[k].img}">
<div>${IMPLANTS[k].name}<br>x${IMPLANTS[k].tap}</div>
${!owned?
`<div class="btn" onclick="buyImpl('${k}')">Купить</div>`:
`<div class="btn" onclick="toggleImpl('${k}')">${eq?"Снять":"Экипировать"}</div>`}
</div>`;
}
show(html);
}
function buyImpl(id){
s.implants[id]=true;
save();openImplants();
}
function toggleImpl(id){
if(s.equipped[id]){
s.tap/=IMPLANTS[id].tap;
delete s.equipped[id];
}else{
s.tap*=IMPLANTS[id].tap;
s.equipped[id]=true;
}
save();openImplants();ui();
}

/* ===== CREW ===== */
function openCrew(){
let html="<h2>Экипаж</h2>";
for(let k in CREW){
let hired=s.crew[k];
html+=`
<div class="item">
<div>${CREW[k].name}<br>+${CREW[k].inc}/сек</div>
<div class="btn" onclick="toggleCrew('${k}')">${hired?"Уволить":"Нанять"}</div>
</div>`;
}
show(html);
}
function toggleCrew(id){
if(s.crew[id]){
s.pph-=CREW[id].inc;
delete s.crew[id];
}else{
s.pph+=CREW[id].inc;
s.crew[id]=true;
}
save();openCrew();ui();
}

/* ===== PROFILE ===== */
function openProfile(){
let html="<h2>Профиль</h2>";
html+=`<div>Лимит кораблей: ${s.shipLimit}</div><hr>`;
html+="<b>Корабли:</b>";
for(let k in s.ships) html+=`<div>${SHIPS[k].name} x${s.ships[k]}</div>`;
html+="<hr><b>Импланты:</b>";
for(let k in s.implants) html+=`<div>${IMPLANTS[k].name}</div>`;
show(html);
}

/* ===== SETTINGS ===== */
function openSettings(){
show(`
<h2>Настройки</h2>
<div class="btn" onclick="setLang('ru')">RU</div>
<div class="btn" onclick="setLang('en')">EN</div>
<div class="btn" onclick="setLang('pl')">PL</div>
<div class="btn" onclick="upgradeLimit()">+ Лимит кораблей</div>
`);
}
function upgradeLimit(){
if(s.shipLimit<9) s.shipLimit+=3;
save();ui();
}
function setLang(l){
s.lang=l;
langModal.style.display="none";
save();
}

/* ===== SAVE ===== */
function save(){
localStorage.cp_save=JSON.stringify(s);
}
</script>
</body>
</html>