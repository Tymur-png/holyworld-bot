<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>CosmoPunk Tap Game</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root{
  --bg:#0a001a;
  --accent1:#ff00ff;
  --accent2:#00ffff;
  --accent3:#ff00aa;
  --panel:rgba(30,10,50,0.4);
  --panel-dark:rgba(15,5,30,0.6);
  --glow1:0 0 30px rgba(255,0,255,0.6);
  --glow2:0 0 30px rgba(0,255,255,0.6);
  --text:#e0e0ff;
  --text-dim:#8888cc;
}
*{margin:0;padding:0;box-sizing:border-box}
body{
  background:radial-gradient(circle at top,#2a0055,#0a001a);
  font-family:'Segoe UI',Arial,sans-serif;
  color:var(--text);
  overflow:hidden;
  height:100vh;
}
#app{height:100vh;position:relative}

/* HUD */
#hud{
  position:absolute;top:12px;left:12px;right:12px;
  display:flex;justify-content:space-between;align-items:flex-start;z-index:10;
  pointer-events:none;
}
.badge{
  background:var(--panel);
  padding:10px 16px;
  border-radius:20px;
  backdrop-filter:blur(12px);
  border:1px solid rgba(255,255,255,0.1);
  font-weight:700;
  font-size:18px;
  box-shadow:var(--glow1);
  pointer-events:auto;
}
#punk-badge{box-shadow:var(--glow1);}
#energy-badge{box-shadow:var(--glow2);font-size:15px;}
#rank{
  font-size:14px;
  opacity:0.8;
  margin-top:4px;
  text-align:center;
}

/* Reactor */
#center{
  position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
}
#reactor{
  width:340px;height:340px;
  border-radius:50%;
  background:radial-gradient(circle,var(--panel),transparent);
  box-shadow:var(--glow1), var(--glow2);
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;
  transition:transform 0.1s;
  border:2px solid rgba(255,0,255,0.3);
}
#reactor:active{transform:scale(0.95);}
#reactor img{width:92%;border-radius:50%;}

/* Floating text */
.float{
  position:absolute;
  font-size:32px;
  font-weight:900;
  pointer-events:none;
  text-shadow:0 0 15px var(--accent2);
  background:linear-gradient(transparent,var(--accent2));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  animation:floatUp 1.2s ease-out forwards;
}
@keyframes floatUp{
  0%{transform:translateY(0);opacity:1}
  100%{transform:translateY(-140px);opacity:0}
}

/* Bottom navigation */
#bottom{
  position:absolute;bottom:0;left:0;right:0;
  padding:12px;
  background:linear-gradient(transparent,var(--bg));
  z-index:10;
}
#bar{
  display:flex;
  gap:10px;
  overflow-x:auto;
  padding-bottom:8px;
}
.btn{
  min-width:100px;
  background:var(--panel-dark);
  border:1px solid rgba(255,255,255,0.15);
  padding:12px 16px;
  border-radius:20px;
  font-weight:700;
  font-size:14px;
  cursor:pointer;
  transition:all 0.2s;
  text-align:center;
  box-shadow:var(--glow1);
}
.btn:active{
  transform:scale(0.95);
  box-shadow:0 0 20px var(--accent1);
}

/* Popup */
#pop{
  position:fixed;inset:0;
  background:rgba(0,0,0,0.9);
  display:none;
  align-items:center;justify-content:center;
  z-index:100;
  backdrop-filter:blur(8px);
}
#card{
  background:var(--panel-dark);
  border:2px solid var(--accent1);
  padding:24px;
  border-radius:24px;
  max-width:92%;
  max-height:92%;
  overflow-y:auto;
  box-shadow:0 0 60px rgba(255,0,255,0.4);
}
h2{
  text-align:center;
  font-size:28px;
  margin-bottom:20px;
  background:linear-gradient(to right,var(--accent1),var(--accent2));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.item{
  background:var(--panel);
  border:1px solid rgba(255,255,255,0.1);
  border-radius:18px;
  padding:16px;
  margin-bottom:14px;
  display:flex;
  gap:16px;
  align-items:center;
  transition:transform 0.2s;
}
.item:hover{transform:scale(1.02);}
.item img{
  width:80px;height:80px;
  object-fit:contain;
  border-radius:12px;
  border:1px solid var(--accent2);
}
.item-info{flex:1}
.item-name{font-weight:700;font-size:18px;margin-bottom:6px}
.item-desc{font-size:14px;opacity:0.8;line-height:1.4}
.buy-btn{
  background:linear-gradient(var(--accent1),var(--accent3));
  color:white;
  border:none;
  padding:10px 20px;
  border-radius:16px;
  font-weight:700;
  cursor:pointer;
}
.buy-btn:disabled{
  background:#333;
  opacity:0.5;
  cursor:not-allowed;
}
</style>
</head>

<body>
<div id="app">

<div id="hud">
  <div>
    <div id="punk-badge" class="badge">0 PUNK</div>
    <div id="rank">Street Rat</div>
  </div>
  <div id="energy-badge" class="badge">0.0 /—Å–µ–∫</div>
</div>

<div id="center">
  <div id="reactor">
    <img src="assets/reactor/reactor.gif" alt="Reactor">
  </div>
</div>

<div id="bottom">
  <div id="bar">
    <div class="btn" onclick="openFleet()">üöÄ –§–õ–û–¢</div>
    <div class="btn" onclick="openCrew()">üë• –≠–ö–ò–ü–ê–ñ</div>
    <div class="btn" onclick="openImplants()">üß† –ò–ú–ü–õ–ê–ù–¢–´</div>
    <div class="btn" onclick="openRaid()">‚öîÔ∏è –†–ï–ô–î</div>
    <div class="btn" onclick="openMarket()">üõí –ú–ê–ì–ê–ó–ò–ù</div>
    <div class="btn" onclick="openProfile()">üë§ –ü–†–û–§–ò–õ–¨</div>
    <div class="btn" onclick="openSettings()">‚öôÔ∏è</div>
  </div>
</div>

</div>

<div id="pop" onclick="if(event.target===this)closePop()">
  <div id="card"></div>
</div>

<script>
Telegram.WebApp.ready();
Telegram.WebApp.expand();

/* ===== DATA ===== */
const RANKS = [
  "Street Rat",
  "Neon Scavenger",
  "Void Pirate",
  "Cyber Overlord",
  "Galaxy Baron"
];

const SHIPS = [
  {id:1, name:"Rusty Drone", desc:"–°–ø–∏—Å–∞–Ω–Ω—ã–π –¥—Ä–æ–Ω –∫–æ—Ä–ø–æ—Ä–∞—Ü–∏–∏", cost:100, income:5},
  {id:2, name:"Scrap Fighter", desc:"–°–æ–±—Ä–∞–Ω –∏–∑ –æ–±–ª–æ–º–∫–æ–≤", cost:500, income:20},
  {id:3, name:"Punk Hauler", desc:"–ö–æ–Ω—Ç—Ä–∞–±–∞–Ω–¥–∏—Å—Ç—Å–∫–∏–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç", cost:2000, income:80},
  {id:4, name:"Neon Corsair", desc:"–ö–æ—Ä–∞–±–ª—å –ø–∏—Ä–∞—Ç—Å–∫–æ–π —ç–ª–∏—Ç—ã", cost:10000, income:300},
  {id:5, name:"Void Reaper", desc:"–ó–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–π –∫–ª–∞—Å—Å. –õ–µ–≥–µ–Ω–¥–∞", cost:50000, income:1000},
  {id:6, name:"Glitch Phantom", desc:"–ù–µ–≤–∏–¥–∏–º—ã–π –¥–ª—è —Ä–∞–¥–∞—Ä–æ–≤", cost:150000, income:2500},
  {id:7, name:"Nova Destroyer", desc:"–ë—ã–≤—à–∏–π —Ñ–ª–∞–≥–º–∞–Ω NovaCore", cost:500000, income:8000},
  {id:8, name:"Black Hole Raider", desc:"–ü–æ–≥–ª–æ—â–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏—é –≤—Ä–∞–≥–æ–≤", cost:2000000, income:25000},
  {id:9, name:"Quantum Leviathan", desc:"–†–∞–∑—Ä—ã–≤–∞–µ—Ç –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ", cost:10000000, income:100000},
  {id:10,name:"Punk Sovereign", desc:"–¢—Ä–æ–Ω –≥–∞–ª–∞–∫—Ç–∏–∫–∏", cost:50000000, income:500000}
];

const IMPLANTS = [
  {key:"base", name:"–ë–∞–∑–æ–≤—ã–π –ò–º–ø–ª–∞–Ω—Ç", desc:"–ü–µ—Ä–≤—ã–π —à–∞–≥ –ª—é–±–æ–≥–æ –ø–∞–Ω–∫–∞", cost:50, income:2},
  {key:"chip", name:"–†–∂–∞–≤—ã–π –ß–∏–ø", desc:"–†–∞–±–æ—Ç–∞–µ—Ç –ø–ª–æ—Ö–æ. –ù–æ —Ä–∞–±–æ—Ç–∞–µ—Ç.", cost:300, income:10},
  {key:"eye", name:"–ö–∏–±–µ—Ä-–ì–ª–∞–∑", desc:"–í–∏–¥–∏—Ç —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞ –∏ —à–∞–Ω—Å—ã", cost:1500, income:40},
  {key:"glitch", name:"–ì–ª–∏—Ç—á-–ü—Ä–æ—Ç–µ–∑", desc:"–ù–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–µ —É—Å–∏–ª–µ–Ω–∏—è –∏ –∫—Ä–∏—Ç—ã", cost:8000, income:150},
  {key:"neuro", name:"–ù–µ–æ-–ù–µ–π—Ä–æ–Ω", desc:"–î—É–º–∞–µ—à—å –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º –º–∏—Ä —Ä–µ–∞–≥–∏—Ä—É–µ—Ç", cost:40000, income:600}
];

let save = JSON.parse(localStorage.getItem("cosmopunk_save")) || {
  punk: 0,
  totalPunk: 0,
  passiveIncome: 0,
  rank: 0,
  ships: {},
  implants: {},
  maxShips: 5,
  lastUpdate: Date.now()
};

/* ===== OFFLINE PROGRESS ===== */
function calculateOffline() {
  const now = Date.now();
  const diffSec = (now - save.lastUpdate) / 1000;
  const earned = save.passiveIncome * diffSec;
  save.punk += earned;
  save.totalPunk += earned;
  save.lastUpdate = now;
}
calculateOffline();

/* ===== UI ELEMENTS ===== */
const punkEl = document.getElementById("punk-badge");
const energyEl = document.getElementById("energy-badge");
const rankEl = document.getElementById("rank");
const reactor = document.getElementById("reactor");
const pop = document.getElementById("pop");
const card = document.getElementById("card");

/* ===== UPDATE UI ===== */
function updateUI() {
  punkEl.textContent = Math.floor(save.punk).toLocaleString() + " PUNK";
  energyEl.textContent = save.passiveIncome.toFixed(1) + " /—Å–µ–∫";
  rankEl.textContent = RANKS[save.rank];

  // Rank progression
  const rankThresholds = [0, 1000, 10000, 50000, 200000, 1000000];
  for (let i = rankThresholds.length - 1; i >= 0; i--) {
    if (save.totalPunk >= rankThresholds[i]) {
      save.rank = i;
      break;
    }
  }
}

/* ===== SAVE ===== */
function saveGame() {
  save.lastUpdate = Date.now();
  localStorage.setItem("cosmopunk_save", JSON.stringify(save));
}

/* ===== TAP ===== */
reactor.onclick = e => {
  save.punk += 1;
  save.totalPunk += 1;

  // Floating +1
  const float = document.createElement("div");
  float.className = "float";
  float.textContent = "+1";
  float.style.left = (e.clientX - 20) + "px";
  float.style.top = (e.clientY - 30) + "px";
  document.body.appendChild(float);
  setTimeout(() => float.remove(), 1200);

  updateUI();
  saveGame();
};

/* ===== POPUP SYSTEM ===== */
function showPopup(html) {
  card.innerHTML = html;
  pop.style.display = "flex";
}
function closePop() {
  pop.style.display = "none";
}

/* ===== FLEET ===== */
function openFleet() {
  let html = `<h2>üöÄ –§–õ–û–¢</h2>`;
  SHIPS.forEach(ship => {
    const owned = save.ships[ship.id];
    if (owned) {
      html += `<div class="item">
        <img src="assets/ships/ship${ship.id}.png">
        <div class="item-info">
          <div class="item-name">${ship.name}</div>
          <div class="item-desc">+${ship.income} /—Å–µ–∫ \( {owned > 1 ? `(x \){owned})` : ""}</div>
        </div>
      </div>`;
    } else {
      const canBuy = save.punk >= ship.cost;
      html += `<div class="item">
        <img src="assets/ships/ship${ship.id}.png">
        <div class="item-info">
          <div class="item-name">${ship.name}</div>
          <div class="item-desc">${ship.desc}<br>–°—Ç–æ–∏–º–æ—Å—Ç—å: \( {ship.cost.toLocaleString()} PUNK<br>–î–æ—Ö–æ–¥: + \){ship.income} /—Å–µ–∫</div>
        </div>
        <button class="buy-btn" \( {!canBuy ? "disabled" : ""} onclick="buyShip( \){ship.id})">–ö–£–ü–ò–¢–¨</button>
      </div>`;
    }
  });
  showPopup(html);
}
function buyShip(id) {
  const ship = SHIPS.find(s => s.id === id);
  if (save.punk < ship.cost) return;
  save.punk -= ship.cost;
  save.ships[id] = (save.ships[id] || 0) + 1;
  save.passiveIncome += ship.income;
  updateUI();
  saveGame();
  openFleet();
}

/* ===== IMPLANTS ===== */
function openImplants() {
  let html = `<h2>üß† –ò–ú–ü–õ–ê–ù–¢–´</h2>`;
  IMPLANTS.forEach(imp => {
    const owned = save.implants[imp.key];
    if (owned) {
      html += `<div class="item">
        <img src="assets/implants/${imp.key}.png">
        <div class="item-info">
          <div class="item-name">${imp.name}</div>
          <div class="item-desc">–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</div>
        </div>
      </div>`;
    } else {
      const canBuy = save.punk >= imp.cost;
      html += `<div class="item">
        <img src="assets/implants/${imp.key}.png">
        <div class="item-info">
          <div class="item-name">${imp.name}</div>
          <div class="item-desc">${imp.desc}<br>–°—Ç–æ–∏–º–æ—Å—Ç—å: \( {imp.cost.toLocaleString()} PUNK<br>–î–æ—Ö–æ–¥: + \){imp.income} /—Å–µ–∫</div>
        </div>
        <button class="buy-btn" \( {!canBuy ? "disabled" : ""} onclick="buyImplant(' \){imp.key}')">–ö–£–ü–ò–¢–¨</button>
      </div>`;
    }
  });
  showPopup(html);
}
function buyImplant(key) {
  const imp = IMPLANTS.find(i => i.key === key);
  if (save.punk < imp.cost) return;
  save.punk -= imp.cost;
  save.implants[key] = true;
  save.passiveIncome += imp.income;
  updateUI();
  saveGame();
  openImplants();
}

/* ===== OTHER SECTIONS ===== */
function openCrew() {
  showPopup(`<h2>üë• –≠–ö–ò–ü–ê–ñ</h2>
    <div class="item">
      <img src="assets/crew/captain.png">
      <div class="item-info">
        <div class="item-name">–ö–∞–ø–∏—Ç–∞–Ω –ö–æ—Å–º–æ</div>
        <div class="item-desc">–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π —Å—Ç—Ä–∞—Ç–µ–≥. –ë—ã–≤—à–∏–π –∞–¥–º–∏—Ä–∞–ª NovaCore.</div>
      </div>
    </div>
    <div class="item">
      <img src="assets/crew/hacker.png">
      <div class="item-info">
        <div class="item-name">–õ–∏—Å–∞-–•–∞–∫–µ—Ä</div>
        <div class="item-desc">–¶–∏—Ñ—Ä–æ–≤–æ–π –ø—Ä–∏–∑—Ä–∞–∫. –í–∑–ª–∞–º—ã–≤–∞–µ—Ç –≤—Å—ë.</div>
      </div>
    </div>
    <div class="item">
      <img src="assets/crew/bot.png">
      <div class="item-info">
        <div class="item-name">–ì–∏–≥–∞–ü–∞–Ω–∫-–ë–æ—Ç</div>
        <div class="item-desc">–ê–≤—Ç–æ–Ω–æ–º–Ω—ã–π —é–Ω–∏—Ç. –î–æ–±—ã–≤–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏—é –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏.</div>
      </div>
    </div>`);
}

function openRaid() { showPopup("<h2>‚öîÔ∏è –†–ï–ô–î</h2><p>–ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –∏ –Ω–∞–≥—Ä–∞–¥—ã ‚Äî —Å–∫–æ—Ä–æ</p>"); }
function openMarket() { showPopup("<h2>üõí –ú–ê–ì–ê–ó–ò–ù</h2><p>–£—Å–∏–ª–µ–Ω–∏—è –∏ –±—É—Å—Ç—ã ‚Äî —Å–∫–æ—Ä–æ</p>"); }
function openSettings() { showPopup("<h2>‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò</h2><p>–Ø–∑—ã–∫, –∑–≤—É–∫ –∏ –¥—Ä—É–≥–∏–µ –æ–ø—Ü–∏–∏ ‚Äî —Å–∫–æ—Ä–æ</p>"); }

function openProfile() {
  let html = `<h2>üë§ –ü–†–û–§–ò–õ–¨ COSMOPUNK</h2>
    <p><strong>–†–∞–Ω–≥:</strong> ${RANKS[save.rank]}</p>
    <p><strong>–í—Å–µ–≥–æ –¥–æ–±—ã—Ç–æ PUNK:</strong> ${Math.floor(save.totalPunk).toLocaleString()}</p>
    <h3 style="margin:20px 0 10px">üöÄ –§–ª–æ—Ç</h3>`;
  Object.keys(save.ships).forEach(id => {
    const count = save.ships[id];
    html += `<img src="assets/ships/ship${id}.png" width="64" style="margin:4px"> `;
    if (count > 1) html += `<sup>x${count}</sup> `;
  });
  html += `<h3 style="margin:20px 0 10px">üß† –ò–º–ø–ª–∞–Ω—Ç—ã</h3>`;
  Object.keys(save.implants).forEach(key => {
    html += `<img src="assets/implants/${key}.png" width="64" style="margin:4px"> `;
  });
  showPopup(html);
}

/* ===== PASSIVE INCOME LOOP ===== */
setInterval(() => {
  save.punk += save.passiveIncome / 10;
  save.totalPunk += save.passiveIncome / 10;
  updateUI();
  saveGame();
}, 100);

updateUI();
</script>
</body>
</html>