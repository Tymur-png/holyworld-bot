<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>CosmoPunk Tap Game v9.0 — Киберпанк-шедевр</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Rajdhani:wght@600;700&family=Exo+2:wght@900&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0a001a;--n1:#ff00ff;--n2:#00ffff;--n3:#ff0088;--glass:rgba(20,0,40,0.6);
    --glow:0 0 40px;--glow2:0 0 80px;--font-main:'Exo 2',sans-serif;--font-title:'Orbitron',sans-serif;
  }
  *{margin:0;padding:0;box-sizing:border-box}
  body{background:var(--bg);color:#fff;overflow:hidden;height:100vh;font-family:var(--font-main);position:relative;
    background:radial-gradient(circle at 50% 10%,#2a0066 0%,#0a001a 40%,#000 100%);}
  body::before{content:"";position:absolute;inset:0;background:radial-gradient(circle at 30% 70%,rgba(0,255,255,0.15) 0%,transparent 50%);pointer-events:none;opacity:0.6}
  body::after{content:"";position:absolute;inset:0;background:linear-gradient(45deg,transparent 45%,rgba(255,0,255,0.03) 49%,rgba(0,255,255,0.03) 51%,transparent 55%);background-size:40px 40px;pointer-events:none;animation:scan 8s linear infinite}
  @keyframes scan{0%{background-position:0 0}100%{background-position:40px 40px}}

  #app{position:relative;width:100vw;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1}

  /* HUD — футуристичный */
  .hud{position:absolute;top:20px;left:20px;right:20px;z-index:100;display:flex;justify-content:space-between;align-items:flex-start}
  .info-panel{background:var(--glass);border:2px solid var(--n2);border-radius:20px;padding:16px 20px;backdrop-filter:blur(20px);box-shadow:var(--glow) var(--n2),inset 0 0 30px rgba(0,255,255,0.1);min-width:280px}
  .title{font-family:var(--font-title);font-size:24px;color:var(--n2);text-shadow:var(--glow) var(--n1);letter-spacing:3px;margin-bottom:8px}
  .energy{font-size:42px;font-weight:900;background:linear-gradient(90deg,var(--n1),var(--n2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:2px}
  .punk{font-size:28px;color:var(--n2);text-shadow:0 0 20px var(--n2);margin:8px 0}
  .stats{display:flex;gap:20px;font-size:18px;margin-top:8px}
  .stat{color:var(--n2);text-shadow:0 0 15px}

  /* Реактор — сердце игры */
  #reactor{width:420px;height:420px;position:relative;cursor:pointer;z-index:50}
  #reactor img{width:100%;height:100%;object-fit:contain;filter:drop-shadow(var(--glow2) var(--n1)) brightness(1.3);animation:pulse 4s infinite}
  @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.06)}}
  .reactor-border{position:absolute;inset:-20px;border:4px solid transparent;border-radius:50%;background:conic-gradient(var(--n1),var(--n2),var(--n1));animation:spin 12s linear infinite;pointer-events:none}
  @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
  #reactor:active img{filter:drop-shadow(0 0 100px var(--n3)) brightness(1.6)}

  /* Поп-апы и криты */
  .floating{position:absolute;font-size:48px;font-weight:900;color:var(--n2);text-shadow:var(--glow2) var(--n1),0 0 60px var(--n3);pointer-events:none;z-index:200;opacity:0}
  .critBoom{position:absolute;font-size:96px;font-weight:900;color:#ff0088;text-shadow:0 0 60px #ff00ff,0 0 100px #ff0088;pointer-events:none;z-index:300;opacity:0}

  /* Кнопки — неоновая роскошь */
  .controls{position:absolute;bottom:30px;left:20px;right:20px;display:grid;grid-template-columns:repeat(3,1fr);gap:16px;z-index:80}
  .btn{background:var(--glass);border:2px solid var(--n2);color:#fff;padding:18px;font-size:18px;font-weight:900;border-radius:20px;backdrop-filter:blur(20px);box-shadow:var(--glow) var(--n1);transition:all 0.3s;letter-spacing:1px;text-transform:uppercase;position:relative;overflow:hidden}
  .btn::before{content:"";position:absolute;inset:0;background:linear-gradient(45deg,transparent 30%,rgba(255,255,255,0.1) 50%,transparent 70%);transform:translateX(-100%);transition:0.6s}
  .btn:hover::before{transform:translateX(100%)}
  .btn:active{transform:scale(0.94);box-shadow:0 0 80px var(--n3)}
  .btn.primary{background:linear-gradient(135deg,var(--n1),var(--n2));color:#000;border:none;box-shadow:var(--glow2) var(--n1)}

  /* Попап — киберпанк-терминал */
  #pop{display:none;position:fixed;inset:0;background:rgba(0,0,20,0.98);z-index:999;align-items:center;justify-content:center;padding:20px}
  .card{background:rgba(10,0,40,0.95);border:3px double var(--n2);border-radius:24px;padding:30px;max-width:560px;width:100%;box-shadow:0 0 100px rgba(0,255,255,0.4);backdrop-filter:blur(30px);position:relative;overflow:hidden}
  .card::before{content:"NEON VOID TERMINAL";position:absolute;top:12px;left:0;right:0;text-align:center;font-family:var(--font-title);font-size:20px;color:var(--n2);text-shadow:var(--glow) var(--n1);letter-spacing:4px}
  .item{background:rgba(255,255,255,0.05);border:1px solid var(--n2);border-radius:16px;padding:20px;margin:16px 0;transition:0.3s}
  .item:hover{box-shadow:0 0 40px var(--n2);transform:translateY(-6px);background:rgba(0,255,255,0.08)}

  /* Анимация глитча */
  .glitch{animation:glitch 0.3s !important}
  @keyframes glitch{0%,100%{transform:translate(0)}20%{transform:translate(-10px,10px)}40%{transform:translate(10px,-10px)}60%{transform:translate(-10px,-10px)}80%{transform:translate(10px,10px)}}
</style>
</head>
<body>
<div id="app">
  <div class="hud">
    <div class="info-panel">
      <div class="title">COSMOPUNK</div>
      <div class="energy" id="energy">0 PUNK</div>
      <div class="punk" id="punk">0.0000 $PUNK</div>
      <div class="stats">
        <div class="stat" id="inc">0 /сек</div>
        <div class="stat" id="rank">Street Rat</div>
      </div>
    </div>
  </div>

  <div id="reactor">
    <img src="https://i.ibb.co/0jKX7Wv/reactor.gif" alt="Neon Reactor">
    <div class="reactor-border"></div>
  </div>

  <div class="controls">
    <div class="btn" id="fleet">ФЛОТ</div>
    <div class="btn" id="crew">ЭКИПАЖ</div>
    <div class="btn" id="implants">ИМПЛАНТЫ</div>
    <div class="btn primary" id="raid">RAID</div>
    <div class="btn" id="market">NFT</div>
    <div class="btn primary" id="tonBtn">CONNECT TON</div>
  </div>
</div>

<div id="pop" onclick="this.style.display='none'">
  <div class="card" onclick="event.stopPropagation()">
    <div id="popContent"></div>
    <div style="margin-top:40px;text-align:center">
      <div class="btn" style="display:inline-block;width:80%" onclick="document.getElementById('pop').style.display='none'">ЗАКРЫТЬ</div>
    </div>
  </div>
</div>

<script>
// === ИГРА v9.0 — КРАСОТА + ФУНКЦИИ ===
const tg = Telegram.WebApp; tg.ready(); tg.expand();
let s = {e:0,p:0,t:0,tap:3,mult:1,pass:0,ships:{r:0,c:0,h:0,f:0,d:0},crew:{},impl:{},last:Date.now()};
const SHIPS = {r:{n:"Void Reaper",p:200000,i:10},c:{n:"Neon Corsair",p:100000,i:5},h:{n:"Punk Hauler",p:50000,i:2},f:{n:"Scrap Fighter",p:20000,i:1},d:{n:"Rusty Drone",p:10000,i:0.3}};

// Сохранение
setInterval(()=>{s.last=Date.now();localStorage.cp9=JSON.stringify(s)},3000);
if(localStorage.cp9)s=JSON.parse(localStorage.cp9);

// Пассив + обмен
setInterval(()=>{s.e+=s.pass/10;if(s.e>=1000){let c=Math.floor(s.e/1000);s.p+=c*0.95;s.e-=c*1000}ui()},100);

// UI
function ui(){
  document.getElementById("energy").innerText=Math.floor(s.e).toLocaleString()+" PUNK";
  document.getElementById("punk").innerText=s.p.toFixed(4)+" $PUNK";
  document.getElementById("inc").innerText=s.pass.toFixed(1)+" /сек";
}

// ТАП — КРАСОТА
document.getElementById('reactor').onclick=function(e){
  let crit=1,r=Math.random();
  if(r<0.005)crit=10;else if(r<0.035)crit=5;else if(r<0.155)crit=2;
  const gain=Math.floor(s.tap*s.mult*crit); s.e+=gain; s.t+=gain;

  const x=e.touches?.[0]?.clientX||e.clientX||innerWidth/2;
  const y=e.touches?.[0]?.clientY||e.clientY||innerHeight/2;

  const pop=document.createElement('div');pop.className='floating';pop.innerText='+'+gain.toLocaleString();
  pop.style.left=x+'px';pop.style.top=y+'px';
  document.body.appendChild(pop);setTimeout(()=>pop.remove(),1600);

  if(crit>1){
    const boom=document.createElement('div');boom.className='critBoom';boom.innerText='×'+crit;
    boom.style.left=(x-100)+'px';boom.style.top=(y-180)+'px';
    boom.animate([{opacity:0,transform:'scale(0)'},{opacity:1,transform:'scale(1.4)'},{opacity:0,transform:'scale(2)'}],{duration:800});
    document.body.appendChild(boom);setTimeout(()=>boom.remove(),900);
  }

  this.classList.add('glitch');setTimeout(()=>this.classList.remove('glitch'),300);
  tg.HapticFeedback.impactOccurred('heavy');
  ui();
}

// КНОПКИ — РАБОТАЮТ КРАСИВО
['fleet','crew','implants','raid','market'].forEach(id=>{
  document.getElementById(id).addEventListener('click',()=>{
    let h=`<div style="font-size:36px;color:#ff00ff;text-align:center;margin-bottom:20px">${id.toUpperCase()}</div>`;
    if(id==='fleet'){
      for(let k in SHIPS){
        let sh=SHIPS[k],o=s.ships[k]||0,p=sh.p*Math.pow(1.15,o);
        h+=`<div class="item"><strong>\( {sh.n}</strong><br>+ \){sh.i}/сек • Цена: \( {p.toLocaleString()}<br>У тебя: \){o}<br><div class="btn primary" style="margin-top:12px" onclick="buyShip('\( {k}', \){p})">КУПИТЬ</div></div>`;
      }
    }else h+=`<div class="item">Скоро в следующем обновлении — огонь будет!</div>`;
    document.getElementById('popContent').innerHTML=h;
    document.getElementById('pop').style.display='flex';
  });
});

function buyShip(k,p){
  if(s.e>=p){s.e-=p;s.ships[k]=(s.ships[k]||0)+1;s.pass+=SHIPS[k].i;tg.showAlert('Куплено!');document.getElementById('pop').style.display='none';ui();}
}

// TON
document.getElementById('tonBtn').addEventListener('click',async()=>{
  const ton = new TON_CONNECT.UI.TonConnectUI({manifestUrl:location.origin+"/tonconnect-manifest.json"});
  await ton.connectWallet();
  document.getElementById('tonBtn').innerText="WALLET OK";
});

ui();
</script>
</body>
</html>