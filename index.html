<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>CosmoPunk Tap Game</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
    :root{--bg:#0a001a;--neon1:#ff00ff;--neon2:#00ffff;--dark:#0f0022}
    body{margin:0;background:var(--bg);color:#fff;font-family:'Courier New',monospace;overflow:hidden;background:radial-gradient(circle at center,#1a0033,#0a001a);}
    #game{position:relative;width:100vw;height:100vh}
    #reactor{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:300px;height:300px;cursor:pointer;filter:drop-shadow(0 0 30px #ff00ff);}
    #energy,#punk,#income{position:absolute;left:0;right:0;text-align:center;text-shadow:0 0 20px var(--neon1);font-weight:bold}
    #energy{top:15px;font-size:36px}
    #punk{top:70px;font-size:28px;color:var(--neon2)}
    #income{top:110px;font-size:20px}
    .btn{position:absolute;background:rgba(0,255,255,0.15);border:2px solid var(--neon2);color:#fff;padding:16px;border-radius:20px;text-align:center;box-shadow:0 0 25px var(--neon2);backdrop-filter:blur(10px);font-weight:bold}
    #shopBtn{bottom:160px;left:20px;right:20px}
    #crewBtn{bottom:100px;left:20px;right:20px}
    #overclockBtn{bottom:30px;left:15px;width:calc(50% - 25px)}
    #glitchBtn{bottom:30px;right:15px;width:calc(50% - 25px)}
    .glitch{animation:glitch 0.3s infinite}
    @keyframes glitch{0%,100%{transform:translate(0)}25%{transform:translate(-8px,8px)}50%{transform:translate(8px,-8px)}}
    .pulse{animation:pulse 2s infinite}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.15)}}
    .particle{position:absolute;color:#00ffff;font-size:40px;pointer-events:none;animation:float 1.2s forwards}
    @keyframes float{to{transform:translateY(-300px);opacity:0}}
</style>
</head>
<body>
<div id="game">
    <div id="energy">0 PUNK Energy</div>
    <div id="punk">0.00 $PUNK</div>
    <div id="income">0 /сек</div>
    <img id="reactor" src="https://i.ibb.co/0jKX7Wv/reactor.gif" class="pulse">
    <div id="shopBtn" class="btn" onclick="openShop()">ТЁМНЫЙ РЫНОК</div>
    <div id="crewBtn" class="btn" onclick="openCrew()">ЭКИПАЖ</div>
    <div id="overclockBtn" class="btn">OVERCLOCK x10</div>
    <div id="glitchBtn" class="btn">GLITCH HACK</div>
</div>

<script>
// === ДАННЫЕ ИГРОКА ===
let player = {
    energy: 0, totalEnergy: 0, punk: 0, tapPower: 1, passiveIncome: 0, multipliers: 1,
    ships: {reaper:0,corsair:0,hauler:0,fighter:0,drone:0},
    lastTime: Date.now()
};

const ships = {
    reaper:  {price:20000000, income:1000, name:"Void Reaper S"},
    corsair: {price:10000000, income:500,  name:"Neon Corsair A"},
    hauler:  {price:5000000,  income:200,  name:"Punk Hauler B"},
    fighter: {price:2000000,  income:100,  name:"Scrap Fighter C"},
    drone:   {price:1000000,  income:50,   name:"Rusty Drone D"}
};

// === СОХРАНЕНИЕ ===
function save(){localStorage.setItem('cosmopunk_v1',JSON.stringify(player)); player.lastTime=Date.now();}
function load(){let s=localStorage.getItem('cosmopunk_v1'); if(s) player=JSON.parse(s);}
setInterval(save,5000);
window.onload=()=>{Telegram.WebApp.ready();Telegram.WebApp.expand();load();offlineCalc();setInterval(passive,1000);setInterval(ui,100);}

// === ОФФЛАЙН ===
function offlineCalc(){
    let diff = Math.min((Date.now()-player.lastTime)/1000, 12*3600);
    let earned = player.passiveIncome * diff;
    player.energy += earned; player.totalEnergy += earned;
    if(earned>1000) Telegram.WebApp.showAlert(`Оффлайн доход: +${earned.toFixed(0)} энергии`);
}

// === ТАПЫ ===
document.getElementById('reactor').onclick=()=>{
    let gain = player.tapPower * player.multipliers;
    player.energy += gain; player.totalEnergy += gain;
    createParticle('+'+gain.toFixed(0));
};
function createParticle(text){
    let p=document.createElement('div'); p.className='particle'; p.innerText=text;
    p.style.left=(event.touches?event.touches[0].clientX:event.clientX)+'px';
    p.style.top=(event.touches?event.touches[0].clientY:event.clientY)+'px';
    document.body.appendChild(p);
    setTimeout(()=>p.remove(),1200);
}

// === ПАССИВ И UI ===
function passive(){player.energy += player.passiveIncome/60; player.totalEnergy += player.passiveIncome/60;}
function ui(){
    document.getElementById('energy').innerText = Number(player.energy.toFixed(0)).toLocaleString() + ' PUNK';
    document.getElementById('punk').innerText = player.punk.toFixed(4) + ' $PUNK';
    document.getElementById('income').innerText = player.passiveIncome.toFixed(1) + ' /сек';
    if(player.energy>=1000){
        let c=Math.floor(player.energy/1000);
        player.punk += c*0.95; player.energy -= c*1000;
    }
}

// === OVERCLOCK ===
let oc=false;
document.getElementById('overclockBtn').onclick=()=>{
    if(oc) return;
    oc=true; player.multipliers*=10;
    document.getElementById('overclockBtn').innerText='30s';
    let t=30;
    let int=setInterval(()=>{
        t--; document.getElementById('overclockBtn').innerText=t+'s';
        if(t<=0){
            clearInterval(int); oc=false;
            player.multipliers/=10;
            document.getElementById('overclockBtn').innerText='OVERCLOCK x10';
            if(Math.random()<0.33){player.energy*=0.95; Telegram.WebApp.showAlert('ПЕРЕГРЕВ! -5% энергии');}
        }
    },1000);
};

// === GLITCH HACK ===
document.getElementById('glitchBtn').onclick=()=>{
    Telegram.WebApp.showAlert('Быстро свайпай по экрану 15 раз!');
    let c=0;
    let listener=()=>{c++; if(c>=15){
        let bonus=20+Math.random()*60;
        player.energy *= 1 + bonus/100;
        Telegram.WebApp.showAlert('GLITCH УСПЕХ +'+bonus.toFixed(1)+'% энергии!');
        document.removeEventListener('touchmove',listener);
    }};
    document.addEventListener('touchmove',listener);
};

// === МАГАЗИН ===
function openShop(){
    let html='<h2 style="color:#ff00ff">ФЛОТ</h2>';
    for(let k in ships){
        let s=ships[k];
        let owned=player.ships[k]||0;
        html+=`<div style="margin:15px;padding:15px;border:2px solid #00ffff;border-radius:15px;background:rgba(0,255,255,0.1)">
            \( {s.name}<br>Доход: \){s.income}/сек<br>Цена: \( {s.price.toExponential()} energy<br>У тебя: \){owned}
            <button style="margin-top:10px;padding:10px;background:#ff00ff;border:none;color:#000" onclick="buy('${k}')">КУПИТЬ</button>
        </div>`;
    }
    Telegram.WebApp.showPopup({title:'ТЁМНЫЙ РЫНОК',message:html});
}
function buy(id){
    let s=ships[id];
    if(player.energy >= s.price){
        player.energy -= s.price;
        player.ships[id]=(player.ships[id]||0)+1;
        s.price = Math.floor(s.price * 1.15);
        player.passiveIncome = Object.keys(player.ships).reduce((a,k)=>a + player.ships[k]*ships[k].income,0) * player.multipliers;
        Telegram.WebApp.showAlert('Куплен '+ships[id].name);
    } else Telegram.WebApp.showAlert('Недостаточно энергии');
}
window.buy=buy;

function openCrew(){
    Telegram.WebApp.showAlert('Экипаж и импланты — в следующем обновлении за 5 минут ;)');
}
</script>
</body>
</html>